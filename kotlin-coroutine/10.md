# 10장 예외 처리

* 코루틴에서 잡히지 않은 예외가 발생했을 때 종료
* 코루틴 빌더는 부모도 종료 시키고, 취소된 부모는 자식도 모두 취소시킨다

```kotlin
fun main() = runBlocking {
    launch {
        launch {
            delay(1000)
            throw Error("Some Error")
        }
        
        launch {
            delay(2000)
            println("Will not be printed")
        }
        
         launch {
            delay(500)
            println("Will be printed")
        }
    }
    
    launch {
        delay(2000)
        println("Will not be printed")
    }
}

// Will be printed
// Exception in thread ....
```



## 코루틴 종료 멈추기



### SupervisorJob



### supervisorScope



### await



## CancellationException은 부모까지 전파되지 않는다

* 예외가 CancellationException의 서브클래스라면 부모로 전파되지 않고 현재 코루틴만 취소함

```kotlin
public class CancellationException extends IllegalStateException {
    private static final long serialVersionUID = -9202173006928992231L;

    public CancellationException() {}
    public CancellationException(String message) {
        super(message);
    }
}
```

* 다른 클래스나 객체로 확장될 수 있음

```kotlin
object MyNonPropagatingException: CancellationException() // 커스텀? 예외

suspend fun main() = coroutineScope {
    launch {
        launch {
            delay(2000)
            println("Will not be printed")
        }
        throw MyNonPropagatingException
    }
    
    launch {
        delay(2000)
        println("Will be printed") // 부모까지 예외 전파되지 않으므로 출력됨
    }
}

// (2초 후)
// Will be printed
```



## 코루틴 예외 핸들러 - CoroutineExceptionHandler 컨텍스트

* 예외 전파를 중단시키지는 않지만, 예외가 발생했을 때 해야할 것들을 정의하는 데 사용
  * ex) 예외 스택 트레이스 출력, 에러 메시지 노출

```kotlin
fun main() = runBlocking {
    val handler = CoroutineExceptionHandler { ctx, exception -> 
        println("Caught $exception")
    }
    
    val scope = CoroutineScope(SupervisorJob() + handler)
    scope.launch {
        delay(1000)
        throw Error("Some error")
    }
    
    scope.launch {
        delay(2000)
        println("Will be printed") // 부모까지 예외 전파되지 않으므로 출력됨
    }
    
    delay(3000)
}

// Caught java.lang.Error : Some Error
// Will beprintted
```

