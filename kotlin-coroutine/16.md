# 16장 채널



```kotlin
interface SendChannel<in E> {
    suspend fun send(element: E)
    fun close(): Boolean
    // ....
}

interface ReceiveChannel<ourt E> {
    suspend fun receive(): E
    fun cancel(cause: CancellationException? = null)
    // ....
}

interface Channel<E>: SendChannel<E>, ReceiveChannel<E>
```



```kotlin
suspend fun main() = coroutineScope {
    val channel = Channel<Int>()
    launch {
        repeat(5) { index ->
            delay(1000)
            println("Producing next one")
            channel.send(index * 2)
        }
    }
    
    launch {
        repeat(5) {
            val received = channel.receive()
            println(received)
        }
    }
}
```

```kotlin
suspend fun main() = coroutineScope {
    val channel = Channel<Int>()
    launch {
        repeat(5) { index ->
            println("Producing next one")
            delay(1000)
            channel.send(index * 2)
        }
        channel.close()
    }
    
    launch {
        for (element in channel) {
            println(element)
        }
        
        // channel.consumeEach { element ->
        //    println(element)
        // }
    }
}
```

## 채널 타입



## 버퍼 오버플로일 때



## 전달되지 않는 원소 핸들러





## 팬아웃 Fan-out



## 팬인 Fan-in



## 파이프라인



```kotlin
fun CoroutineScope.numbers(): ReceiveChannel<Int> = 
    produce {
        repeat(3) { num ->
            send(num + 1)
        }
    }
    
fun CoroutineScope.square(numbers: ReceiveChannel<Int>) = 
    produce {
        for (num in numbers) {
            send(num * num)
        }
    }

suspend fun main() = coroutineScope {
    val numbers = numbers()
    val squared = square(numbers)
    for (num in squared) {
        println(num)
    }
}

// 1
// 4
// 9
```



## 통신의 기본 형태로서의 채널



## 실제 사용 예

